<div class="container">
    <div class="row">
        <!-- coluna 1 -->
        <div class="col-md-3" style="padding-top: 0.65rem; padding-bottom: 0.7rem; border-right: 1px solid #e9ecef;">

            <div>
                <div class="row align-self-start mx-auto mt-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem; border: 1px solid #343a40; background: #5bc0de;">
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; font-size: large"></a>
                        <a id="vendasHoje" class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; padding-left: 0.2rem; font-size: large"></a>
                    </div>
                    <div class="w-100"></div>
                    <div style="padding-bottom: 0.65rem;">
                        <a class="nav-item" data-toggle="modal"
                           style="float: left;">Vendas de hoje</a>
                    </div>
                    <div class="w-100"></div>
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-size: small">Total liquido vendido hoje</a>
                    </div>
                </div>
            </div>

            <div>
                <div class="row mx-auto align-self-end">

                    <a href="#" onclick="open_file('pedido.html')" class="nav-link" href="pedido.html">
                        <i class="fa fa-fw fa-plus-circle"></i>
                        <span class="nav-link-text">Lançar Novo Pedido</span>
                    </a>

                </div>
            </div>

        </div>

        <!-- coluna 2 -->
        <div class="col-md-3" style="padding-top: 0.65rem; padding-bottom: 0.7rem">
            <!--item1-->
            <div class="pb-5">
                <div class="row align-self-start mx-auto mt-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem; border: 1px solid #343a40; background: #007bff;">
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; font-size: large"></a>
                        <a id="vendasPeriodo" class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; padding-left: 0.2rem; font-size: large"></a>
                    </div>
                    <div class="w-100"></div>
                    <div style="padding-bottom: 0.65rem;">
                        <a class="nav-item" data-toggle="modal"
                           style="float: left;">Vendas do período</a>
                    </div>
                    <div class="w-100"></div>
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-size: small">Total liquido no período</a>
                    </div>
                </div>
            </div>
            <!--item 2-->
            <div class="pb-5">
                <div class="row align-self-center mx-auto mt-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem; border: 1px solid #343a40; background: #449d44;">
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; font-size: large"></a>
                        <a id="valorMedia" class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; padding-left: 0.2rem; font-size: large"></a>
                    </div>
                    <div class="w-100"></div>
                    <div style="padding-bottom: 0.65rem;">
                        <a class="nav-item" data-toggle="modal"
                           style="float: left;">Média do período</a>
                    </div>
                    <div class="w-100"></div>
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-size: small">Valor médio vendido por dia</a>
                    </div>
                </div>
            </div>
            <!--item 3-->
            <div>
                <div class="row align-self-end mx-auto my-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem; border: 1px solid #343a40; background: #c9302c;">
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; font-size: large">+</a>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; padding-left: 0.2rem; font-size: large">23,02</a>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-weight: bold; padding-left: 0.2rem; font-size: large">%</a>
                    </div>
                    <div class="w-100"></div>
                    <div style="padding-bottom: 0.65rem;">
                        <a class="nav-item" data-toggle="modal"
                           style="float: left;">Variação</a>
                    </div>
                    <div class="w-100"></div>
                    <div>
                        <a class="nav-item" data-toggle="modal"
                           style="float: left; font-size: small">Em relação ao periodo anterior</a>
                    </div>
                </div>
            </div>
        </div>

        <!--coluna3-->
        <div class="col-md-6" style="padding-top: 0.65rem; padding-bottom: 0.7rem">
            <!--item1-->
            <div class="pb-5">
                <div class="row mx-auto">

                    <div class="col-md-12 mt-3">
                        <div class="row">
                            <div class="col-md-3">
                                <a class="nav-item align-bottom py-1" data-toggle="modal"
                                   style="float: left; font-size: large;">Período</a>
                            </div>
                            <div id="reportrange" class="col-md-9 pull-right"
                                 style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
                                <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
                                <span></span> <b class="caret"></b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="grafico">
                <div class="row align-self-start mx-auto mt-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem;">
                    <canvas id="myChartB" style="position: relative; height:25vh; width:80vw"></canvas>
                </div>
            </div>

            <div>
                <div class="row align-self-start mx-auto mt-3 col-md-12"
                     style="padding-top: 0.65rem; padding-bottom: 0.65rem;">
                    <canvas id="myChartL" style="position: relative; height:25vh; width:80vw"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="vendor/chart.js/Chart.bundle.min.js"></script>
<script type="text/javascript" src="moment.min.js"></script>
<script type="text/javascript" src="daterangepicker.js"></script>
<script>
    console.log("usuario" + usuarioLogado);
    var app = new Vue({
        el: '#app',
        data: {
            dataIni: '',
            dataFin: '',
            dias: '',
            vendasPeriodo: ''
        },
        created: function () {
            this.teste();
            this.setDatePicker();
            this.vendasHoje();
        },
        methods: {
            teste: function () {
                console.log("teste")
            },
            vendasHoje: function () {
                this.$http.get("http://localhost:8080/pedido/vendashoje")
                    .then(function (res) {
                        var venda = "R$ " + res.body.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+\,)/g, "$1.");
                        $("#vendasHoje").text(venda);
                    }, function (res) {
                        console.log(res);
                    });

            },

            setDatePicker: function () {

                var start = moment().subtract(10, 'days');
                var end = moment();


                function cb(start, end) {
                    $('#reportrange span').html(start.format('DD/MM/YYYY') + ' - ' + end.format('DD/MM/YYYY'));
                    dataIni = start.format('YYYY/MM/DD');
                    dataFin = end.format('YYYY/MM/DD');

                    $.ajax({
                        method: "GET",
                        url: "http://localhost:8080/pedido/vendasperiodo?dataIni=" + dataIni + "&dataFin=" + this.dataFin,
                        data: {}
                    }).done(function (msg) {
                        var formatado = "R$ " + msg.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+\,)/g, "$1.");

                        $("#vendasPeriodo").text(formatado);
                        this.vendasPeriodo = msg;
                        dias = ((end.date() + (end.month() * 30) + (end.year() * 365)) - (start.date() + (start.month() * 30) + (start.year() * 365)));
                        var result = this.vendasPeriodo / dias;
                        var arredondado = "R$ " + result.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+\,)/g, "$1.");
                        $("#valorMedia").text(arredondado);

                        $.ajax({
                            method: "GET",
                            url: "http://localhost:8080/pedido/vendasdiaperiodo?dataIni=" + dataIni + "&dataFin=" + dataFin,
                            data: {}
                        }).done(function (msg) {
                            datasPeriodo = msg;
                        });

                        $.ajax({
                            method: "GET",
                            url: "http://localhost:8080/pedido/vendasvalorperiodo?dataIni=" + dataIni + "&dataFin=" + dataFin,
                            data: {}
                        }).done(function (msg) {
                            datasValor = msg;
                        });

                        // ----------------------------------------------------------

                        function setGrafico() {
//                                console.log("grafico  dias "+dias+" dataini"+dataIni);
                            var ctx = document.getElementById("myChartB");
                            if (graficoSetado) {
                                myChartB.destroy();
                                myChartL.destroy();
                            }
                            console.log(coresFundo)
                            myChartB = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: datasPeriodo,
                                    datasets: [{
                                        label: 'Total Líquido',
                                        data: datasValor,
                                        backgroundColor: [
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',
                                            'rgba(30, 144, 255, 0.2)',

                                        ],
                                        borderColor: [
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                            'rgba(30, 144, 255, 1)',
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true
                                            }
                                        }]
                                    }
                                }
                            });


                            var ctx = document.getElementById("myChartL");
                            myChartL = new Chart(ctx, {
                                "type": "line",
                                "data": {
                                    "labels": datasPeriodo,
                                    "datasets": [{
                                        "label": "Total Líquido",
                                        "data": datasValor,
                                        "fill": false,
                                        "borderColor": "rgb(75, 192, 192)",
                                        "lineTension": 0.1
                                    }]
                                },
                                "options": {}
                            });
                        }

                        setTimeout(function () {

                            setGrafico();
                            graficoSetado = true;
                        }, 600)
                    });
                }

                $('#reportrange').daterangepicker({
                    startDate: start,
                    endDate: end,
                    format: 'DD/MM/YYYY',
                    ranges: {
                        'Hoje': [moment(), moment()],
                        'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Últimos 7 Dias': [moment().subtract(6, 'days'), moment()],
                        'Últimos 30 Dias': [moment().subtract(29, 'days'), moment()],
                        'Esse Mês': [moment().startOf('month'), moment()],
                        'Último Mês': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    }
                }, cb);

                cb(start, end);
            }

        }
    })

</script>
